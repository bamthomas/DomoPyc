<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Current Cost</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='highcharts.js') }}" type="text/javascript"></script>
    <style type="text/css">
        .watt {
            font-family: monospace;
            font-size: 40px;
        }

        div {
            text-align: center;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            $(document).ready(function () {
                Highcharts.setOptions({
                    global: {
                        useUTC: false
                    }
                });

                var chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'graph',
                        type: 'areaspline',
                        marginRight: 10
                    },
                    title: {
                        text: 'Consommation courante'
                    },
                    xAxis: {
                        type: 'datetime',
                        tickPixelInterval: 150
                    },
                    yAxis: {
                        title: {
                            text: 'Watt'
                        }
                    },
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.name + '</b><br/>' +
                                    Highcharts.dateFormat('%H:%M:%S', this.x) + ': <b>' + this.y + ' w</b>';
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    exporting: {
                        enabled: false
                    },
                    series: [
                        {
                            name: 'Consommation courante',
                            data: (function () {
                                var data = [];
                                var time = new Date().getTime();
                                for (var i = -150; i <= 0; i++) {
                                    data.push({
                                        x: time + i * 1000,
                                        y: 0
                                    });
                                }
                                return data;
                            })()
                        }
                    ]
                });
                var sse = function() {
                    var source = new EventSource('/stream');
                    source.onmessage = function (e) {
                        var item = JSON.parse(e.data);
                        $("#current").text(item.watt);
                        chart.series[0].addPoint([new Date().getTime(), item.watt], true, true);
                    };
                }();
            });
        });
    </script>
</head>
<body>
<div>
    <p class="watt"><span id="current">?</span>&nbsp;Watt</p>
    <div id="graph" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
</div>

</body>
</html>


